***************************************************************************
*									  *
*   Copyright (c) 2009, Lawrence Livermore National Security, LLC. 	  *
*   Produced at the Lawrence Livermore National Laboratory 		  *
*   Written by: Gavin M. Bell (gavin@llnl.gov) 				  *
*   LLNL-CODE-420962.	BSD Open Source License				  *
*									  *
*   All rights reserved. This file is part of the:                        *
*   Earth System Grid (ESG) Data Node Software Stack                      *
*									  *
***************************************************************************

HOWTO:

---
Hello, 

The following describes how to get started with installing the ESG
Data Node.  The installation scripts may be in flux, as we
continuously improve the process. Please provide us with your input
regarding your installation experience.


The update script can be fetched from our website at:
http://rainbow.llnl.gov/dist/esg-node/esg-update

Follow the instructions below describing how to run the update script.
       
The update and install scripts is written in bash and is intended to
be run on CentOS/RedHat Linux distributions as *root* or a root
effective user via "sudo -s" (IMPORTANT: Do not run scripts directly
with sudo.  Sudo filers out needed environment variables!).  I suggest
taking all the defaults presented and reading and following the
script's suggestions.

(The entire process takes approximately a bit under an hour)

Thank you for your participation.

*************
Instructions:
*************
- Before you do any installation REGISTER (get an account) at the
gateway you intend to connect to:
	(ESG-PCMDI) http://pcmdi3.llnl.gov/esgcet/
- Be sure the machine you are installing on is a CentOS/Redhat linux
family distribution.
- Be sure the machine has a fully qualified hostname that responds to
both  hostname -s and hostname --domain.
- The machine must have all development headers installed.
- Must have root (or sudo) privileges.

1) download the update script to /usr/local/bin on the target machine
   % cd /usr/local/bin
   % wget http://rainbow.llnl.gov/dist/esg-node/esg-update

2) % chmod 755 esg-update

     You only run esg-update initially to get the install scripts and
then subsequently to get the latest revisions of install scripts.

3) Become root or root equiv
   
   % sudo -s  (do not run directly from sudo because sudo filters env vars)

4) Make sure you manually check the md5 checksum... 
   (We don't want to run just any ol' script as root!!! :-)

   % diff <(md5sum esg-update | tr -s " " | cut -d " " -f 1) <(curl http://rainbow.llnl.gov/dist/esg-node/esg-update.md5 | tr -s " " | cut -d " " -f 1)
   
   (there should be NO difference!)

   Besides the manual check the script is self verifying.
   If the script has been tampered with in any way, it will indicate
   this and NOT RUN. At which point you must fetch the file from the
   distribution site again. - step 1
   

5) Fetch the latest node installation script 
   
   (md5 verification is done within the scripts from now on, so make
   sure it always says "[VERIFIED]" after a file is fetched)
   
   % esg-update node

6) Run the installation script (read carefully...)
   
   (The default build includes globus components configured for a *64*bit system)

   % esg-node --install --verify

   IMPORTANT NOTE!!!
   If you have a 32bit system make sure you set the variable
   globus_word_size=32 before executing the install, like this...

   % globus_word_size=32 esg-node --install --verify

   May I suggest doing a multi pass installation.

   -First install the core components

   % esg-node --install

   -Then install globus 
   (say no [N] to all the already installed components until you get
   to globus)

   % globus_word_size=32 esg-node --install

   Test the use of myproxy and the publisher by doing the test publish

   % esg-node --test-pub

7) Answer prompts...
	[y/N] means "N" is the default, you may just hit return
	Default values appear in [] brackets. hitting return uses them.

8) Join the appropriate mailing list...
   End Users : esg-node-user@lists.llnl.gov
   Developers: esg-node-dev@lists.llnl.gov
   
   Send an email to majordomo@lists.llnl.gov with the body:
   subscribe <list-name>

********
Errant key strokes are picked up, so please don't keep hitting return etc...
(be careful) 

As mentioned the script is in bash, so feel free to read it, however, do
not modify the script text, that would void the support contract :-).

If you have any questions... contact me - Gavin (gavin@llnl.gov), or Bob
or Dean. My number is +1-925-422-7436.

Enjoy!

-ESG Data Node Team
